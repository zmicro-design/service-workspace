#!/bin/bash

load inquirer

check() {
  if [ ! -f $SERVICE_CONFIG ]; then
     touch $SERVICE_CONFIG
  fi

  config::load_file $SERVICE_CONFIG

  if [ -z "$SERVICE_WORKSPACE_COMPANY" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_COMPANY:" value
    echo "SERVICE_WORKSPACE_COMPANY=$value" >> $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_INLETS_CLIENT_ID" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_INLETS_CLIENT_ID:" value
    echo "SERVICE_WORKSPACE_INLETS_CLIENT_ID=$value" > $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_INLETS_CLIENT_SECRET" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_INLETS_CLIENT_SECRET:" value
    echo "SERVICE_WORKSPACE_INLETS_CLIENT_SECRET=$value" >> $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_INLETS_PORT" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_INLETS_PORT:" value
    echo "SERVICE_WORKSPACE_INLETS_PORT=$value" >> $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_SOURCE_CODE_DIR" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_SOURCE_CODE_DIR:" value
    echo "SERVICE_WORKSPACE_SOURCE_CODE_DIR=$value" >> $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_GIT_USER" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_GIT_USER:" value
    echo "SERVICE_WORKSPACE_GIT_USER=$value" >> $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_GIT_EMAIL" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_GIT_EMAIL:" value
    echo "SERVICE_WORKSPACE_GIT_EMAIL=$value" >> $SERVICE_CONFIG
  fi

  if [ -z "$SERVICE_WORKSPACE_SSH_PORT" ]; then
    inquirer::text "请输入 SERVICE_WORKSPACE_SSH_PORT:" value
    echo "SERVICE_WORKSPACE_SSH_PORT=$value" >> $SERVICE_CONFIG
  fi

  if [ "$SERVICE_WORKSPACE_PREVILEGED" != "true" ]; then
    local choices=(
      "Yes"
      "No"
    )
    inquirer::select "Allow root previledge ?" choices value
    if [ "$value" = "Yes" ]; then
      echo "SERVICE_WORKSPACE_PREVILEGED=true" >> $SERVICE_CONFIG
    fi
  fi

  #@TODO
  export SERVICE_WORKSPACE_COMPANY=$SERVICE_WORKSPACE_COMPANY
  export SERVICE_WORKSPACE_INLETS_CLIENT_ID=$SERVICE_WORKSPACE_INLETS_CLIENT_ID
  export SERVICE_WORKSPACE_INLETS_CLIENT_SECRET=$SERVICE_WORKSPACE_INLETS_CLIENT_SECRET
  export SERVICE_WORKSPACE_INLETS_PORT=$SERVICE_WORKSPACE_INLETS_PORT
  export SERVICE_WORKSPACE_SOURCE_CODE_DIR=$SERVICE_WORKSPACE_SOURCE_CODE_DIR
  export SERVICE_WORKSPACE_GIT_USER=$SERVICE_WORKSPACE_GIT_USER
  export SERVICE_WORKSPACE_GIT_EMAIL=$SERVICE_WORKSPACE_GIT_EMAIL
  export SERVICE_WORKSPACE_SSH_PORT=$SERVICE_WORKSPACE_SSH_PORT
  export SERVICE_WORKSPACE_PREVILEGED=$SERVICE_WORKSPACE_PREVILEGED
}

check $@
